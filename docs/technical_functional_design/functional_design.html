<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Navid Gharapanjeh">
<meta name="author" content="Delvin Bacho">
<meta name="dcterms.date" content="2025-02-07">

<title>Functional Design – Automatic Solar Panel Detection - Documentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-327735d1480bff6f7510335fe22ad292.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>


</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../docs/technical_functional_design/technical_design.html">Project Documentation</a></li><li class="breadcrumb-item"><a href="../../docs/technical_functional_design/functional_design.html">Functional Design</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Automatic Solar Panel Detection - Documentation</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Process Management</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/process_management/way_of_working.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Way of Working</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/process_management/retrospectives.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Retrospectives</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Project Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/technical_functional_design/technical_design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Technical Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/technical_functional_design/functional_design.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Functional Design</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#background-and-context" id="toc-background-and-context" class="nav-link active" data-scroll-target="#background-and-context">1. Background and Context</a></li>
  <li><a href="#problem-statement" id="toc-problem-statement" class="nav-link" data-scroll-target="#problem-statement">2. Problem Statement</a></li>
  <li><a href="#stakeholders" id="toc-stakeholders" class="nav-link" data-scroll-target="#stakeholders">3. Stakeholders</a></li>
  <li><a href="#vision" id="toc-vision" class="nav-link" data-scroll-target="#vision">4. Vision</a></li>
  <li><a href="#project-artifacts-handover-documents" id="toc-project-artifacts-handover-documents" class="nav-link" data-scroll-target="#project-artifacts-handover-documents">5. Project Artifacts &amp; Handover Documents</a></li>
  <li><a href="#business-goals-and-functional-requirements" id="toc-business-goals-and-functional-requirements" class="nav-link" data-scroll-target="#business-goals-and-functional-requirements">6. Business Goals and Functional Requirements</a>
  <ul class="collapse">
  <li><a href="#goal-1-automation-of-solarpanel-detection-system" id="toc-goal-1-automation-of-solarpanel-detection-system" class="nav-link" data-scroll-target="#goal-1-automation-of-solarpanel-detection-system">Goal 1: Automation of Solarpanel Detection System</a></li>
  <li><a href="#goal-2-solar-panel-detection-accuracy" id="toc-goal-2-solar-panel-detection-accuracy" class="nav-link" data-scroll-target="#goal-2-solar-panel-detection-accuracy">Goal 2: Solar Panel Detection Accuracy</a></li>
  <li><a href="#goal-3-house-id-detection-connect-with-kadaster-api" id="toc-goal-3-house-id-detection-connect-with-kadaster-api" class="nav-link" data-scroll-target="#goal-3-house-id-detection-connect-with-kadaster-api">Goal 3: House ID Detection / Connect with Kadaster API</a></li>
  <li><a href="#mapping-requirements-to-pipeline-phases" id="toc-mapping-requirements-to-pipeline-phases" class="nav-link" data-scroll-target="#mapping-requirements-to-pipeline-phases">6.1 Mapping Requirements to Pipeline Phases</a></li>
  </ul></li>
  <li><a href="#non-functional-requirements" id="toc-non-functional-requirements" class="nav-link" data-scroll-target="#non-functional-requirements">7. Non-Functional Requirements</a></li>
  <li><a href="#scenarios-for-requirements" id="toc-scenarios-for-requirements" class="nav-link" data-scroll-target="#scenarios-for-requirements">8. Scenarios for Requirements</a>
  <ul class="collapse">
  <li><a href="#r-01-select-and-implement-an-appropriate-analytics-platform-to-store-images-model-outputs-and-evaluation-results." id="toc-r-01-select-and-implement-an-appropriate-analytics-platform-to-store-images-model-outputs-and-evaluation-results." class="nav-link" data-scroll-target="#r-01-select-and-implement-an-appropriate-analytics-platform-to-store-images-model-outputs-and-evaluation-results."><strong>R-01: Select and implement an appropriate analytics platform to store images, model outputs, and evaluation results.</strong></a></li>
  <li><a href="#r-02-choose-and-configure-a-workflow-orchestration-tool-to-automate-the-data-and-ml-pipeline-execution." id="toc-r-02-choose-and-configure-a-workflow-orchestration-tool-to-automate-the-data-and-ml-pipeline-execution." class="nav-link" data-scroll-target="#r-02-choose-and-configure-a-workflow-orchestration-tool-to-automate-the-data-and-ml-pipeline-execution."><strong>R-02: Choose and configure a workflow orchestration tool to automate the data and ML pipeline execution.</strong></a></li>
  <li><a href="#r-03-implement-automated-data-preprocessing-to-ensure-images-are-correctly-formatted-before-model-training." id="toc-r-03-implement-automated-data-preprocessing-to-ensure-images-are-correctly-formatted-before-model-training." class="nav-link" data-scroll-target="#r-03-implement-automated-data-preprocessing-to-ensure-images-are-correctly-formatted-before-model-training."><strong>R-03: Implement automated data preprocessing to ensure images are correctly formatted before model training.</strong></a></li>
  <li><a href="#r-04-develop-a-machine-learning-model-that-processes-aerial-or-satellite-images-and-accurately-detects-the-presence-of-solar-panels." id="toc-r-04-develop-a-machine-learning-model-that-processes-aerial-or-satellite-images-and-accurately-detects-the-presence-of-solar-panels." class="nav-link" data-scroll-target="#r-04-develop-a-machine-learning-model-that-processes-aerial-or-satellite-images-and-accurately-detects-the-presence-of-solar-panels."><strong>R-04: Develop a machine learning model that processes aerial or satellite images and accurately detects the presence of solar panels.</strong></a></li>
  <li><a href="#r-05-evaluate-and-compare-the-performance-of-multiple-object-detection-models-to-determine-the-most-suitable-approach-for-solar-panel-identification." id="toc-r-05-evaluate-and-compare-the-performance-of-multiple-object-detection-models-to-determine-the-most-suitable-approach-for-solar-panel-identification." class="nav-link" data-scroll-target="#r-05-evaluate-and-compare-the-performance-of-multiple-object-detection-models-to-determine-the-most-suitable-approach-for-solar-panel-identification."><strong>R-05: Evaluate and compare the performance of multiple object detection models to determine the most suitable approach for solar panel identification.</strong></a></li>
  <li><a href="#r-06-acquire-high-quality-dutch-aerial-imagery-to-ensure-the-final-trained-model-can-be-applied-effectively-to-local-housing-data." id="toc-r-06-acquire-high-quality-dutch-aerial-imagery-to-ensure-the-final-trained-model-can-be-applied-effectively-to-local-housing-data." class="nav-link" data-scroll-target="#r-06-acquire-high-quality-dutch-aerial-imagery-to-ensure-the-final-trained-model-can-be-applied-effectively-to-local-housing-data."><strong>R-06: Acquire high-quality Dutch aerial imagery to ensure the final trained model can be applied effectively to local housing data.</strong></a></li>
  <li><a href="#r-07-establish-a-method-to-integrate-the-ml-models-output-with-existing-housing-datasets-by-linking-detection-results-to-specific-houses-for-example-using-house-ids." id="toc-r-07-establish-a-method-to-integrate-the-ml-models-output-with-existing-housing-datasets-by-linking-detection-results-to-specific-houses-for-example-using-house-ids." class="nav-link" data-scroll-target="#r-07-establish-a-method-to-integrate-the-ml-models-output-with-existing-housing-datasets-by-linking-detection-results-to-specific-houses-for-example-using-house-ids."><strong>R-07: Establish a method to integrate the ML model’s output with existing housing datasets by linking detection results to specific houses, for example, using House IDs.</strong></a></li>
  <li><a href="#r-08-develop-an-automated-approach-to-replace-or-reduce-manual-data-scraping-processes-enabling-a-more-efficient-and-scalable-way-to-populate-the-final-dataset." id="toc-r-08-develop-an-automated-approach-to-replace-or-reduce-manual-data-scraping-processes-enabling-a-more-efficient-and-scalable-way-to-populate-the-final-dataset." class="nav-link" data-scroll-target="#r-08-develop-an-automated-approach-to-replace-or-reduce-manual-data-scraping-processes-enabling-a-more-efficient-and-scalable-way-to-populate-the-final-dataset."><strong>R-08: Develop an automated approach to replace or reduce manual data scraping processes, enabling a more efficient and scalable way to populate the final dataset.</strong></a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="functional_design.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../docs/technical_functional_design/technical_design.html">Project Documentation</a></li><li class="breadcrumb-item"><a href="../../docs/technical_functional_design/functional_design.html">Functional Design</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Functional Design</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Navid Gharapanjeh </p>
             <p>Delvin Bacho </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 7, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>This project aims to leverage machine learning (ML) to detect solar panels from satellite images, detecting BAG/Housing ID. To ensure scalability, reproducibility, and efficiency, an end-to-end MLOps pipeline will be implemented.</p>
<section id="background-and-context" class="level2">
<h2 class="anchored" data-anchor-id="background-and-context">1. Background and Context</h2>
<p>The NOWATT project aims to accelerate the energy transition and mitigate grid congestion by promoting energy-neutral neighborhoods. This initiative integrates multiple stakeholders, including residents, SMEs, and government agencies, to optimize energy efficiency through AI-driven solutions.</p>
<p>A key aspect of this project is leveraging artificial intelligence to categorize homes and residents, enabling personalized sustainability recommendations and district-level planning. One of the major factors influencing a home’s energy efficiency rating is the presence of solar panels, as they significantly impact a building’s energy label score.</p>
<p>By 2030, all rental properties in the Netherlands must have an energy label of at least D. Housing associations and landlords will need to take sustainability measures to comply with these regulations. Nijhuis Bouw, an organization specializing in sustainable housing solutions, is particularly interested in automating the assessment of energy efficiency to streamline this transition.</p>
<p>To support this, our project focuses on developing an automated solar panel detection system that processes satellite and aerial images. This tool will integrate with public datasets such as Kadaster to enhance energy label predictions, helping stakeholders make informed decisions on housing sustainability.</p>
</section>
<section id="problem-statement" class="level2">
<h2 class="anchored" data-anchor-id="problem-statement">2. Problem Statement</h2>
<p>Manually identifying solar panels from aerial and satellite imagery is time-consuming and inefficient. Automating this process with machine learning can significantly improve accuracy and scalability.</p>
<p>This project addresses two key challenges:<br>
1. <strong>Solar Panel Detection</strong>: Developing a machine learning model that can determine whether a given house in an image has solar panels.<br>
2. <strong>BAG ID Retrieval</strong>: Linking the detected solar panel data to the correct house using the BAG ID system, a unique identifier for each building in the Netherlands.</p>
<p>To achieve this, we will <strong>design and implement a complete data and machine learning pipeline</strong>, ensuring the automation of <strong>data ingestion/versioning, data preprocessing, model training, model validation, model deployment and model feedback</strong>. The pipeline will be designed for seamless integration into existing sustainability assessment systems used by Nijhuis Bouw.</p>
<p>The model will be trained using <strong>satellite images from South Germany</strong>, where solar panel density is high. However, in production, it needs to analyze <strong>aerial images of houses in the Netherlands</strong>, requiring robust generalization across different data sources.</p>
<p>Additionally, the results should ideally be integrated into the broader <strong>energy labeling pipeline</strong> to support sustainability assessments for housing associations and policymakers.</p>
</section>
<section id="stakeholders" class="level2">
<h2 class="anchored" data-anchor-id="stakeholders">3. Stakeholders</h2>
<ul>
<li><strong>Developer Team for operationalising Solar Panel Detection utilising MLOps principle</strong>: Delvin Bacho &amp; Navid Gharapanjeh<br>
</li>
<li><strong>Project Lead &amp; NOWATT Representative</strong>: Selin Çolakhasanoglu (Saxion University of Applied Science, Data Science Team)<br>
</li>
<li><strong>Client Organization</strong>: Nijhuis Bouw (Sustainability and Housing Solutions) – Contact: Roel Prinsen<br>
</li>
<li><strong>Funding Agency</strong>: Taskforce for Applied Research SIA</li>
</ul>
</section>
<section id="vision" class="level2">
<h2 class="anchored" data-anchor-id="vision">4. Vision</h2>
<p><strong>FOR</strong> Nijhuis Bouw <br> <strong>WHO</strong> need an automated and scalable way to assess and improve the energy efficiency of buildings <br> <strong>THE</strong> Solar Panel Detection System <br> <strong>THAT</strong> automatically detects solar panels from aerial and satellite imagery to support energy label predictions <br> <strong>AND THAT</strong> integrates with public datasets (Kadaster) to provide accurate building-specific insights <br> <strong>UNLIKE</strong> manual surveys and outdated energy labeling methods <br> <strong>OUR PRODUCT</strong> offers an automated, scalable, and ML-driven approach to sustainability assessment <br> </p>
</section>
<section id="project-artifacts-handover-documents" class="level2">
<h2 class="anchored" data-anchor-id="project-artifacts-handover-documents">5. Project Artifacts &amp; Handover Documents</h2>
<p>Since the project started in the past, we got some documents and artifacts we can work with. Here is a list of things we got:</p>
<ul>
<li><p><strong><a href="https://www.nature.com/articles/s41597-023-02539-8">Research Paper &amp; Satellite Imagery Dataset</a>:</strong> A VHR satellite imagery dataset from germany with annotated residential solar panels for training detection models and supporting energy monitoring research.</p></li>
<li><p><strong>Python Script to Split Data:</strong> Script to divide satellite images into training and test datasets (<code>split_trainTest.py</code>).</p></li>
<li><p><strong>Household Data for Energy Labels:</strong><br>
CSV files containing building and energy label data for houses in Enschede.</p>
<ul>
<li><code>merged_3dbag_EPonline_Enschede.csv</code>: Contains detailed building information.<br>
</li>
<li><code>subset_CDF_Enschede.csv</code>: Includes utility data like gas connections and network operator info.<br>
</li>
<li>These datasets are merged for analysis.</li>
</ul></li>
<li><p><strong>Energy Label Analysis Notebook:</strong><br>
Jupyter Notebook (<code>energie_label_final-Enschede.ipynb</code>) that processes the merged household datasets, cleans and integrates data, and trains a machine learning model to classify energy labels.</p></li>
</ul>
</section>
<section id="business-goals-and-functional-requirements" class="level2">
<h2 class="anchored" data-anchor-id="business-goals-and-functional-requirements">6. Business Goals and Functional Requirements</h2>
<p>The NOWATT project leverages <strong>computer vision</strong> to automate solar panel detection, links results with <strong>BAG/Housing ID</strong> for energy labels, and develops a full <strong>MLOps pipeline</strong> for efficient deployment. In <a href="#chapter-8">Chapter 8</a>, the requirements are specified using scenarios. These are the goals that we try to achive:</p>
<section id="goal-1-automation-of-solarpanel-detection-system" class="level3">
<h3 class="anchored" data-anchor-id="goal-1-automation-of-solarpanel-detection-system">Goal 1: Automation of Solarpanel Detection System</h3>
<p><strong>In order to</strong> continuously improve and rapidly deploy our solar panel detection system to stakeholders,<br>
<strong>As</strong> the developer team,<br>
<strong>We want</strong> an automated, end-to-end MLOps pipeline that reduces manual overhead, ensures consistent data and model workflows, and accelerates deployment to production.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 5%">
<col style="width: 89%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th>ID</th>
<th>Requirement Description</th>
<th>MoSCoW</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>R-01</td>
<td>Select and implement an analytics platform to store images, model outputs, and performance metrics for easy retrieval.</td>
<td>Must</td>
</tr>
<tr class="even">
<td>R-02</td>
<td>Configure a workflow orchestration tool that automatically manages data ingestion, preprocessing, and model training runs.</td>
<td>Must</td>
</tr>
<tr class="odd">
<td>R-03</td>
<td>Automate data preprocessing so images are correctly formatted and validated before model training begins.</td>
<td>Must</td>
</tr>
</tbody>
</table>
</section>
<section id="goal-2-solar-panel-detection-accuracy" class="level3">
<h3 class="anchored" data-anchor-id="goal-2-solar-panel-detection-accuracy">Goal 2: Solar Panel Detection Accuracy</h3>
<p><strong>In order to</strong> To efficiently detect energy labels of houses in the Netherlands using Machine Learning in 2025,<br>
<strong>As</strong> the Client Organization,<br>
<strong>We want</strong> to automate the detection and integration of solar panel identification into the NOWATT project process using computer vision.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 86%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th>ID</th>
<th>Requirement Description</th>
<th>MoSCoW</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>R-04</td>
<td>Develop a machine learning model that processes aerial or satellite images and accurately detects the presence of solar panels.</td>
<td>Must</td>
</tr>
<tr class="even">
<td>R-05</td>
<td>Evaluate and compare the performance of multiple object detection models to determine the most suitable approach for solar panel identification.</td>
<td>Must</td>
</tr>
<tr class="odd">
<td>R-06</td>
<td>Acquire high-quality Dutch aerial imagery to ensure the final trained model can be applied effectively to local housing data.</td>
<td>Should</td>
</tr>
</tbody>
</table>
</section>
<section id="goal-3-house-id-detection-connect-with-kadaster-api" class="level3">
<h3 class="anchored" data-anchor-id="goal-3-house-id-detection-connect-with-kadaster-api">Goal 3: House ID Detection / Connect with Kadaster API</h3>
<p><strong>In order to</strong> link detected solar panel detections with the existing housing data for better energy label predictions,<br>
<strong>As</strong> the Project Lead,<br>
<strong>I want</strong> to get also the House ID as an output of the pipeline/system using the Kadaster API, ensuring at least 85% successful matches.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 44%">
<col style="width: 29%">
</colgroup>
<thead>
<tr class="header">
<th>ID</th>
<th>Requirement Description</th>
<th>MoSCoW</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>R-07</td>
<td>Establish a method to integrate the ML model’s output with existing housing datasets by linking detection results to specific houses, for example, using House IDs.</td>
<td>Should</td>
</tr>
<tr class="even">
<td>R-08</td>
<td>Develop an automated approach to replace or reduce manual data scraping processes, enabling a more efficient and scalable way to populate the final dataset.</td>
<td>Could</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="mapping-requirements-to-pipeline-phases" class="level3">
<h3 class="anchored" data-anchor-id="mapping-requirements-to-pipeline-phases">6.1 Mapping Requirements to Pipeline Phases</h3>
<p>Below is an overview of the main phases in our envisioned ML pipeline. We currently focus on the phases most relevant to this project (<strong>Data Ingestion/Versioning</strong>, <strong>Data Preprocessing</strong>, <strong>Model Training</strong>, <strong>Model Validation</strong>, <strong>Model Deployment</strong>, and <strong>Model Feedback</strong>). Other phases, such as <strong>Data Validation</strong>, <strong>Model Analysis</strong>, and <strong>Model Versioning</strong>, are out of scope. The Requirements defined are now linked to each phase of the ML-Lifecycle. In general, we need to say, that we will deal with two types of data. One the inference data, which is publicly available and already labeled. The other, is the inference Data, which is different type of data than the training data.</p>
<section id="phase-1-data-ingestion-versioning" class="level4">
<h4 class="anchored" data-anchor-id="phase-1-data-ingestion-versioning">Phase 1: Data Ingestion / Versioning</h4>
<p><strong>Relevant Requirements:</strong> - <strong>R-01</strong><br>
“Select and implement an analytics platform to store images, model outputs, and performance metrics for easy retrieval.” - <strong>R-02</strong><br>
“Configure a workflow orchestration tool that automatically manages data ingestion, preprocessing, and model training runs.” - <strong>R-08</strong><br>
“Develop an automated approach to replace or reduce manual data scraping processes, enabling a more efficient and scalable way to populate the final dataset.”</p>
<p><strong>Scope &amp; Purpose:</strong><br>
In this phase, we collect data (e.g., satellite or aerial images, addresses, and house IDs), store it in a version-controlled environment, and automate the process to reduce manual overhead.</p>
</section>
<section id="phase-2-data-validation" class="level4">
<h4 class="anchored" data-anchor-id="phase-2-data-validation">Phase 2: Data Validation</h4>
<p><em>(Out of Scope currently—no direct requirements yet.)</em></p>
</section>
<section id="phase-3-data-preprocessing" class="level4">
<h4 class="anchored" data-anchor-id="phase-3-data-preprocessing">Phase 3: Data Preprocessing</h4>
<p><strong>Relevant Requirement:</strong> - <strong>R-03</strong><br>
“Automate data preprocessing so images are correctly formatted and validated before model training begins.”</p>
<p><strong>Scope &amp; Purpose:</strong><br>
Once data is ingested, it must be cleaned and prepared for model training. This includes ensuring images have consistent formats, resolutions, and metadata. By automating preprocessing (R-03), we minimize errors and improve the efficiency of subsequent steps.</p>
</section>
<section id="phase-4-model-training-without-tuning" class="level4">
<h4 class="anchored" data-anchor-id="phase-4-model-training-without-tuning">Phase 4: Model Training (without tuning)</h4>
<p><strong>Relevant Requirements:</strong> - <strong>R-04</strong><br>
“Develop a machine learning model that processes aerial or satellite images and accurately detects the presence of solar panels.” - <strong>R-05</strong><br>
“Evaluate and compare the performance of multiple object detection models to determine the most suitable approach for solar panel identification.” - <strong>R-06</strong><br>
“Acquire high-quality Dutch aerial imagery to ensure the final trained model can be applied effectively to local housing data.”</p>
<p><strong>Scope &amp; Purpose:</strong><br>
In this phase, we build and refine our computer vision model(s) for solar panel detection. Requirement (R-04) lays out the core objective of accurately detecting solar panels, while (R-05) ensures multiple models are compared for optimal performance. Requirement (R-06) secures the Dutch imagery needed to adapt the model to local housing conditions.</p>
</section>
<section id="phase-5-model-analysis" class="level4">
<h4 class="anchored" data-anchor-id="phase-5-model-analysis">Phase 5: Model Analysis</h4>
<p><em>(Out of Scope currently—no direct requirements yet.)</em></p>
</section>
<section id="phase-6-model-versioning-validation" class="level4">
<h4 class="anchored" data-anchor-id="phase-6-model-versioning-validation">Phase 6: Model Versioning / Validation</h4>
<p><em>(Out of Scope currently—no direct requirements yet.)</em></p>
</section>
<section id="phase-7-model-deployment" class="level4">
<h4 class="anchored" data-anchor-id="phase-7-model-deployment">Phase 7: Model Deployment</h4>
<p><strong>Note:</strong><br>
While “rapid deployment” is part of our overall <strong>Goal 1</strong> (i.e., automating and accelerating the pipeline), there are no <em>explicit</em> requirements that solely address the deployment process. In practice, R-02 (workflow orchestration) supports deployment by automating end-to-end steps, but we have not defined specific “Must” or “Should” requirements for deployment alone.</p>
</section>
<section id="phase-8-model-feedback" class="level4">
<h4 class="anchored" data-anchor-id="phase-8-model-feedback">Phase 8: Model Feedback</h4>
<p><em>(Out of Scope currently—no direct requirements yet.)</em></p>
<hr>
</section>
</section>
</section>
<section id="non-functional-requirements" class="level2">
<h2 class="anchored" data-anchor-id="non-functional-requirements">7. Non-Functional Requirements</h2>
<section id="qr-1" class="level4">
<h4 class="anchored" data-anchor-id="qr-1">QR-1</h4>
<p><strong>Tag:</strong> Performance<br>
<strong>Ambition:</strong> Deliver near–real-time solar panel detection for quick decision-making. <br> <strong>Scale:</strong> Up to 1,000 images per batch without significant slowdowns.<br>
<strong>Meter:</strong><br>
- <strong>Inference Time/Image (ms)</strong><br>
- <strong>Training Completion (hrs)</strong><br>
<strong>Goal:</strong><br>
- Inference ≤ 10ms per image on a single GPU.<br>
- Training a new model (50 epochs) within 3 hours.</p>
</section>
</section>
<section id="scenarios-for-requirements" class="level2">
<h2 class="anchored" data-anchor-id="scenarios-for-requirements">8. Scenarios for Requirements</h2>
<p><a id="chapter-8"></a></p>
<section id="r-01-select-and-implement-an-appropriate-analytics-platform-to-store-images-model-outputs-and-evaluation-results." class="level3">
<h3 class="anchored" data-anchor-id="r-01-select-and-implement-an-appropriate-analytics-platform-to-store-images-model-outputs-and-evaluation-results."><strong>R-01: Select and implement an appropriate analytics platform to store images, model outputs, and evaluation results.</strong></h3>
<section id="scenario-1-image-and-result-storage" class="level4">
<h4 class="anchored" data-anchor-id="scenario-1-image-and-result-storage">Scenario 1: Image and Result Storage</h4>
<p><strong>Given</strong> a processed image and its detection result<br>
<strong>When</strong> the system completes inference<br>
<strong>Then</strong> the image, detection label, and confidence score should be stored in the analytics platform</p>
<hr>
</section>
</section>
<section id="r-02-choose-and-configure-a-workflow-orchestration-tool-to-automate-the-data-and-ml-pipeline-execution." class="level3">
<h3 class="anchored" data-anchor-id="r-02-choose-and-configure-a-workflow-orchestration-tool-to-automate-the-data-and-ml-pipeline-execution."><strong>R-02: Choose and configure a workflow orchestration tool to automate the data and ML pipeline execution.</strong></h3>
<section id="scenario-1-pipeline-automation" class="level4">
<h4 class="anchored" data-anchor-id="scenario-1-pipeline-automation">Scenario 1: Pipeline Automation</h4>
<p><strong>Given</strong> a new batch of labeled images is added for training in bucket A <strong>When</strong> the workflow orchestration tool runs the pipeline<br>
<strong>Then</strong> all steps (data ingestion, preprocessing, model training etc.) should execute in sequence automatically</p>
</section>
<section id="scenario-2-pipeline-automation" class="level4">
<h4 class="anchored" data-anchor-id="scenario-2-pipeline-automation">Scenario 2: Pipeline Automation</h4>
<p><strong>Given</strong> a new batch of images is added for processing in bucket B <strong>When</strong> the workflow orchestration tool runs the pipeline<br>
<strong>Then</strong> the inference process should be runned</p>
<hr>
</section>
</section>
<section id="r-03-implement-automated-data-preprocessing-to-ensure-images-are-correctly-formatted-before-model-training." class="level3">
<h3 class="anchored" data-anchor-id="r-03-implement-automated-data-preprocessing-to-ensure-images-are-correctly-formatted-before-model-training."><strong>R-03: Implement automated data preprocessing to ensure images are correctly formatted before model training.</strong></h3>
<section id="scenario-1-image-preprocessing" class="level4">
<h4 class="anchored" data-anchor-id="scenario-1-image-preprocessing">Scenario 1: Image Preprocessing</h4>
<p><strong>Given</strong> a raw aerial or satellite image<br>
<strong>When</strong> the preprocessing module runs<br>
<strong>Then</strong> the image should be resized, normalized, and stored in the preprocessed dataset</p>
</section>
<section id="scenario-2-batch-preprocessing" class="level4">
<h4 class="anchored" data-anchor-id="scenario-2-batch-preprocessing">Scenario 2: Batch Preprocessing</h4>
<p><strong>Given</strong> a batch of raw images<br>
<strong>When</strong> preprocessing is triggered<br>
<strong>Then</strong> all images in the dataset should be processed and validated for model training</p>
</section>
</section>
<section id="r-04-develop-a-machine-learning-model-that-processes-aerial-or-satellite-images-and-accurately-detects-the-presence-of-solar-panels." class="level3">
<h3 class="anchored" data-anchor-id="r-04-develop-a-machine-learning-model-that-processes-aerial-or-satellite-images-and-accurately-detects-the-presence-of-solar-panels."><strong>R-04: Develop a machine learning model that processes aerial or satellite images and accurately detects the presence of solar panels.</strong></h3>
<section id="scenario-1-successful-solar-panel-detection" class="level4">
<h4 class="anchored" data-anchor-id="scenario-1-successful-solar-panel-detection">Scenario 1: Successful Solar Panel Detection</h4>
<p><strong>Given</strong> an aerial or satellite image of a house with solar panels<br>
<strong>When</strong> the machine learning model processes the image<br>
<strong>Then</strong> the system should return a detection result indicating “Solar Panels Detected” with a confidence score</p>
</section>
<section id="scenario-2-no-solar-panel-detected" class="level4">
<h4 class="anchored" data-anchor-id="scenario-2-no-solar-panel-detected">Scenario 2: No Solar Panel Detected</h4>
<p><strong>Given</strong> an aerial or satellite image of a house without solar panels<br>
<strong>When</strong> the machine learning model processes the image<br>
<strong>Then</strong> the system should return a detection result indicating “No Solar Panels Detected” with a confidence score</p>
<hr>
</section>
</section>
<section id="r-05-evaluate-and-compare-the-performance-of-multiple-object-detection-models-to-determine-the-most-suitable-approach-for-solar-panel-identification." class="level3">
<h3 class="anchored" data-anchor-id="r-05-evaluate-and-compare-the-performance-of-multiple-object-detection-models-to-determine-the-most-suitable-approach-for-solar-panel-identification."><strong>R-05: Evaluate and compare the performance of multiple object detection models to determine the most suitable approach for solar panel identification.</strong></h3>
<section id="scenario-1-model-performance-evaluation" class="level4">
<h4 class="anchored" data-anchor-id="scenario-1-model-performance-evaluation">Scenario 1: Model Performance Evaluation</h4>
<p><strong>Given</strong> multiple trained object detection models<br>
<strong>When</strong> the system evaluates them using a standardized test dataset<br>
<strong>Then</strong> the system should generate a comparison report with metrics such as accuracy, precision, recall, and IoU</p>
</section>
<section id="scenario-2-selection-of-the-best-model" class="level4">
<h4 class="anchored" data-anchor-id="scenario-2-selection-of-the-best-model">Scenario 2: Selection of the Best Model</h4>
<p><strong>Given</strong> performance evaluation results of multiple models<br>
<strong>When</strong> the system determines the most accurate and reliable model<br>
<strong>Then</strong> the selected model should be marked as the default for deployment</p>
<hr>
</section>
</section>
<section id="r-06-acquire-high-quality-dutch-aerial-imagery-to-ensure-the-final-trained-model-can-be-applied-effectively-to-local-housing-data." class="level3">
<h3 class="anchored" data-anchor-id="r-06-acquire-high-quality-dutch-aerial-imagery-to-ensure-the-final-trained-model-can-be-applied-effectively-to-local-housing-data."><strong>R-06: Acquire high-quality Dutch aerial imagery to ensure the final trained model can be applied effectively to local housing data.</strong></h3>
<section id="scenario-1-image-acquisition" class="level4">
<h4 class="anchored" data-anchor-id="scenario-1-image-acquisition">Scenario 1: Image Acquisition</h4>
<p><strong>Given</strong> the need to apply the ML model to Dutch housing data<br>
<strong>When</strong> high-quality aerial images of Dutch houses are sourced<br>
<strong>Then</strong> the images should be stored and made available for model testing and inference</p>
</section>
<section id="scenario-2-api-usage" class="level4">
<h4 class="anchored" data-anchor-id="scenario-2-api-usage">Scenario 2: API Usage</h4>
<p><strong>Given</strong> an API like PDOK or Google Maps <strong>When</strong> calling the API using an address <strong>Then</strong> the api should respond with an aerial housing image.</p>
<hr>
</section>
</section>
<section id="r-07-establish-a-method-to-integrate-the-ml-models-output-with-existing-housing-datasets-by-linking-detection-results-to-specific-houses-for-example-using-house-ids." class="level3">
<h3 class="anchored" data-anchor-id="r-07-establish-a-method-to-integrate-the-ml-models-output-with-existing-housing-datasets-by-linking-detection-results-to-specific-houses-for-example-using-house-ids."><strong>R-07: Establish a method to integrate the ML model’s output with existing housing datasets by linking detection results to specific houses, for example, using House IDs.</strong></h3>
<section id="scenario-1-house-id-assignment" class="level4">
<h4 class="anchored" data-anchor-id="scenario-1-house-id-assignment">Scenario 1: House ID Assignment</h4>
<p><strong>Given</strong> an image and an adress where the ML model detects solar panels<br>
<strong>When</strong> the system retrieves the corresponding House ID <strong>Then</strong> the detection result should be linked to the correct House ID in the final housing dataset</p>
</section>
<section id="scenario-2-missing-house-id" class="level4">
<h4 class="anchored" data-anchor-id="scenario-2-missing-house-id">Scenario 2: Missing House ID</h4>
<p><strong>Given</strong> an image where the ML model detects solar panels<br>
<strong>When</strong> the system is unable to find a matching House ID<br>
<strong>Then</strong> the system should log the detection result as “House ID Not Found”</p>
<hr>
</section>
</section>
<section id="r-08-develop-an-automated-approach-to-replace-or-reduce-manual-data-scraping-processes-enabling-a-more-efficient-and-scalable-way-to-populate-the-final-dataset." class="level3">
<h3 class="anchored" data-anchor-id="r-08-develop-an-automated-approach-to-replace-or-reduce-manual-data-scraping-processes-enabling-a-more-efficient-and-scalable-way-to-populate-the-final-dataset."><strong>R-08: Develop an automated approach to replace or reduce manual data scraping processes, enabling a more efficient and scalable way to populate the final dataset.</strong></h3>
<section id="scenario-1-get-postal" class="level4">
<h4 class="anchored" data-anchor-id="scenario-1-get-postal">Scenario 1: Get Postal</h4>
<p><strong>Given</strong> a city name <strong>When</strong> the cityname is passed to the API <strong>Then</strong> it should respond with all the addresses of the city</p>
</section>
<section id="scenario-2-automated-data-retrieval" class="level4">
<h4 class="anchored" data-anchor-id="scenario-2-automated-data-retrieval">Scenario 2: Automated Data Retrieval</h4>
<p><strong>Given</strong> an address <strong>When</strong> the address is passed to the kadaster API and Common datafactory API <strong>Then</strong> it should respond with data that can be included in the final dataset for calculating energy labels</p>
<hr>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>